:root {
    --bg-body: #000000; --bg-panel: #050505; --bg-card: #0a0a0a; --border: #1a1a1a;
    --text-main: #e0e0e0; --text-dim: #777; --green: #0ecb81; --red: #f6465d;
    --blue: #3772ff; --gold: #f0b90b; --purple: #8b5cf6; --hold: #444;
}
body.light-mode {
    --bg-body: #f0f0f0; --bg-panel: #ffffff; --bg-card: #e5e5e5; --border: #cccccc;
    --text-main: #111111; --text-dim: #555555; --hold: #ccc;
}

* { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

body { 
    background: var(--bg-body); color: var(--text-main); font-family: 'Inter', sans-serif; 
    height: 100vh; display: flex; flex-direction: column; overflow: hidden; font-size: 11px;
}

/* --- MODAL STYLES --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); z-index: 2000;
    display: none; align-items: center; justify-content: center;
}
.modal-box {
    background: #0e0e0e; border: 1px solid var(--blue); width: 85%; max-width: 320px;
    border-radius: 8px; padding: 15px; text-align: left; position: relative;
    box-shadow: 0 0 20px rgba(55, 114, 255, 0.2); animation: popIn 0.2s ease-out;
}
@keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

.modal-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid #222; padding-bottom: 10px; }
.modal-icon { font-size: 18px; color: var(--blue); width: 30px; text-align: center; }
.modal-title { font-size: 14px; font-weight: 800; color: #fff; font-family: 'JetBrains Mono'; }
.modal-desc { font-size: 11px; color: #aaa; line-height: 1.5; margin-bottom: 15px; }
.modal-live-box { background: #000; border: 1px solid #333; padding: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
.modal-lbl { font-size: 10px; font-weight: 700; color: #666; }
.modal-val { font-size: 14px; font-weight: 800; color: #fff; font-family: 'JetBrains Mono'; }
.close-modal { position: absolute; top: 10px; right: 10px; color: #555; background: none; border: none; font-size: 16px; cursor: pointer; }

/* HEADER */
.top-nav { height: 44px; background: var(--bg-panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 12px; flex-shrink: 0; z-index: 100; }
.brand { font-family: 'JetBrains Mono'; font-weight: 800; font-size: 14px; display:flex; align-items:center; gap:5px; }
.brand span { color: var(--blue); }
.market-select { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main); padding: 5px 10px; font-family: 'JetBrains Mono'; font-size: 12px; font-weight: 700; border-radius: 4px; }
.price-box { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.price-live { font-family: 'JetBrains Mono'; font-weight: 800; font-size: 16px; color: var(--text-main); }
.theme-btn { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main); width: 30px; height: 30px; border-radius: 4px; display:flex; align-items:center; justify-content:center; }

/* STATS */
.stats-container { display: flex; flex-direction: column; background: var(--bg-panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
.stat-row { display: grid; grid-template-columns: repeat(4, 1fr); height: 32px; border-bottom: 1px solid var(--border); }
.stat-box { padding: 0 6px; display: flex; align-items: center; justify-content: space-between; border-right: 1px solid var(--border); cursor: pointer; transition: 0.1s; }
.stat-box:active { background: #111; }
.stat-lbl { font-size: 9px; font-weight: 700; color: var(--text-dim); display:flex; gap:4px; align-items:center; }
.stat-val { font-size: 10px; font-weight: 700; font-family: 'JetBrains Mono'; }

/* --- NEW LAYOUT SYSTEM --- */
.layout-grid { display: flex; flex: 1; overflow: hidden; }

/* Main Trading Area (Charts + Core) */
.main-stage { flex: 1; display: flex; flex-direction: column; min-width: 0; }

/* 1M Chart Area (Full Width) */
.top-deck { height: 40%; border-bottom: 1px solid var(--border); position: relative; width: 100%; }

/* Lower Deck (Split: Charts Left, Core Right) */
.bottom-deck { flex: 1; display: flex; overflow: hidden; }
.col-charts-lower { flex: 1; overflow-y: auto; background: #000; border-right: 1px solid var(--border); }

/* Chart Styles */
.chart-box { width: 100%; position: relative; border-bottom: 1px solid var(--border); }
.chart-box.main-chart { height: 100%; border:none; } /* For top chart */
.chart-box.sub-chart { aspect-ratio: 1 / 1; } /* For lower charts */

.chart-tag { position: absolute; top: 5px; left: 5px; z-index: 10; background: rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 3px; font-size: 10px; font-weight: 800; color: #aaa; border: 1px solid #333; pointer-events: none; display:flex; align-items:center; gap:5px; }

/* Core Panel (Moved to bottom right) */
.col-brain { width: 170px; min-width: 170px; background: var(--bg-panel); display: flex; flex-direction: column; z-index: 20; border-right: 1px solid var(--border); }

/* Engines Sidebar (Far Right) */
.col-engines { width: 90px; min-width: 90px; background: var(--bg-body); display: flex; flex-direction: column; border-left: 1px solid var(--border); }

.panel-head { padding: 8px; background: var(--bg-card); border-bottom: 1px solid var(--border); font-size: 9px; font-weight: 800; color: var(--text-dim); text-transform: uppercase; display:flex; justify-content:space-between; align-items:center; }
.col-engines .panel-head { justify-content: center; gap: 5px; }

.panel-body { flex: 1; overflow-y: auto; padding: 4px; }

.signal-box { background: var(--bg-card); border: 2px solid var(--hold); border-radius: 4px; padding: 10px 4px; text-align: center; margin-bottom: 8px; cursor: pointer; }
.sig-val { font-family: 'JetBrains Mono'; font-size: 18px; font-weight: 900; color: var(--text-main); margin: 2px 0; }
.buy-mode { border-color: var(--green); background: rgba(14, 203, 129, 0.15); } .buy-mode .sig-val { color: var(--green); }
.sell-mode { border-color: var(--red); background: rgba(246, 70, 93, 0.15); } .sell-mode .sig-val { color: var(--red); }

.ai-card { background: var(--bg-card); border: 1px solid var(--border); border-left: 3px solid; padding: 6px 4px; margin-bottom: 4px; cursor: pointer; border-radius: 4px; transition: all 0.2s; }
.ai-card:hover { background: #111; transform: translateX(2px); }
.ai-name { font-size: 10px; font-weight: 700; color: var(--text-main); display:flex; justify-content:space-between; align-items:center; }
.ai-msg { font-size: 9px; color: var(--text-dim); margin-top: 3px; font-family: 'JetBrains Mono'; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.c-green { border-left-color: var(--green); } 
.c-purple { border-left-color: var(--purple); }
.c-gold { border-left-color: var(--gold); }
.c-blue { border-left-color: var(--blue); }
.c-red { border-left-color: var(--red); }

.matrix-con { background: #000; border: 1px solid #222; padding: 2px; margin-top: 5px; cursor:pointer; }
.ob-row { display: flex; justify-content: space-between; font-family: 'JetBrains Mono'; font-size: 10px; padding: 1px 4px; }

.log-wrap { font-family: 'JetBrains Mono'; font-size: 9px; color: #666; margin-top: auto; height: 120px; overflow-y: auto; padding: 4px; border-top: 1px solid var(--border); background: var(--bg-card); }

.led { width: 5px; height: 5px; background: #333; border-radius: 50%; min-width: 5px; } 
.led.on { background: var(--green); box-shadow: 0 0 5px var(--green); }

/* PERMISSION */
#permModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; display: flex; align-items: center; justify-content: center; }
.perm-box { background: #111; border: 1px solid #333; padding: 25px; text-align: center; border-radius: 8px; width: 85%; max-width: 300px; }
.perm-btn { background: var(--blue); color: #fff; border: none; padding: 12px 20px; margin-top: 15px; border-radius: 4px; font-weight: 800; width: 100%; font-family: 'Inter'; }
